<div class="container">

  <!-- Mensaje -->
  <div *ngIf="mensaje"
       [ngClass]="{'alert-success': mensaje.startsWith('✅'), 'alert-error': !mensaje.startsWith('✅')}"
       class="alert">
    {{ mensaje }}
  </div>

  <h2>Actualizar Citas</h2>

 <!-- Listado de citas elegibles -->
  <table class="tabla" *ngIf="citas.length > 0; else sinCitasActualizar">
    <thead>
      <tr>
        <th>ID</th>
        <th>Paciente</th>
        <th>Médico</th>
        <th>Fecha</th>
        <th>Hora</th>
        <th>Motivo</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let cita of citasPaginadas">
        <td>{{ cita.id }}</td>
        <td>{{ cita.pacienteNombre }}</td>
        <td>{{ cita.medicoNombre }}</td>
        <td>{{ cita.fecha }}</td>
        <td>{{ cita.hora }}</td>
        <td>{{ cita.motivo }}</td>
        <td>
          <button (click)="seleccionarCita(cita)">Actualizar</button>
        </td>
      </tr>
    </tbody>
  </table>
  <ng-template #sinCitasActualizar>
    <div class="no-citas">
      No tienes citas programadas con al menos 2 horas de anticipación para actualizar.
    </div>
  </ng-template>

  <!-- Formulario de actualización -->
  <div *ngIf="citaSeleccionadaId !== null" class="formulario-box">
    <h3>Actualizar Cita</h3>
    <form [formGroup]="formulario" (ngSubmit)="onSubmit()" class="formulario">
      <div class="form-group">
        <label>Médico:</label>
        <select formControlName="idMedico">
          <option [ngValue]="null">Selecciona un médico</option>
          <option *ngFor="let medico of medicos" [ngValue]="medico.id">
            {{ medico.nombre }} {{ medico.apellido }} - {{ medico.especialidad }}
          </option>
        </select>
      </div>

      <div class="horarios" *ngIf="medicoSeleccionado">
        <h4>Horarios de {{ medicoSeleccionado.nombre }} {{ medicoSeleccionado.apellido }}</h4>
        <ul>
          <li *ngFor="let h of medicoSeleccionado.horarios">
            {{ h.dia }}: {{ h.horaInicio }} - {{ h.horaFin }}
          </li>
        </ul>
      </div>

      <div class="form-group">
        <label>Fecha:</label>
        <input formControlName="fecha" type="date">
      </div>

      <div class="form-group">
        <label>Hora:</label>
        <input formControlName="hora" type="time">
      </div>

      <div class="form-group">
        <label>Motivo:</label>
        <input formControlName="motivo" type="text">
      </div>

      <button type="submit">Guardar cambios</button>
    </form>
  </div>
</div>


<div class="pagination" *ngIf="citas.length > 0">
  <button type="button" (click)="paginaAnterior()" [disabled]="paginaActual === 1">Anterior</button>
  <button
    type="button"
    *ngFor="let pagina of paginas"
    (click)="irPagina(pagina)"
    [class.active]="pagina === paginaActual">
    {{ pagina }}
  </button>
  <button type="button" (click)="paginaSiguiente()" [disabled]="paginaActual === totalPaginas">Siguiente</button>
</div>
